
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Building a Discord Bot with Node-RED and OpenAI for Seamless User Interaction</title>
    <link rel="stylesheet" href="../styles.css">
    
</head>
<body style="background-color: #ffffff;">
    <header>
        <nav>
            <div class="logo">
                <a href="/index.en.html">APIVIS</a>
            </div>
            <ul class="nav-links">
                <li><a href="/index.en.html#services">Services</a></li>
                <li><a href="/index.en.html#about">About Us</a></li>
                <li><a href="/index.en.html#blog">Blog</a></li>
                <li><a href="/index.en.html#contact">Contact</a></li>
            </ul>
            <div class="lang-switcher">
                <a href="/posts/building-a-discord-bot-with-node-red-and-openai-for-seamless-user-interaction-m9vpu.en.html" class="lang-active" data-lang="en">EN</a> | <a href="/posts/building-a-discord-bot-with-node-red-and-openai-for-seamless-user-interaction-m9vpu.sv.html" class="" data-lang="sv">SV</a>
            </div>
            <div class="hamburger">
                <div></div>
                <div></div>
                <div></div>
            </div>
        </nav>
    </header>
    <main>
        <section>
            <h2>Building a Discord Bot with Node-RED and OpenAI for Seamless User Interaction</h2>

            <div><p><img src="/img/architecture-bridge-buildings-1472612.jpg" alt="architecture-bridge-buildings"></p>
<p>In this post, we&#39;ll walk you through how to create a smart and interactive Discord bot using Node-RED and OpenAI. Our bot listens to user commands, processes them with OpenAI&#39;s powerful language model, and responds intelligently in your Discord channel. Let&#39;s dive into how all of this comes together! </p>
<h3>Overview</h3>
<p>Our flow is designed to accomplish these tasks:</p>
<p>• Listen to messages in a specific Discord channel (e.g., &quot;support&quot;).</p>
<p>• Identify when users are addressing the bot.</p>
<p>• Manage conversations intelligently, keeping track of new and ongoing sessions.</p>
<p>• Use OpenAI to generate responses to user queries.</p>
<p>• Handle different statuses of the conversation to ensure smooth interaction.</p>
<h3>Nodes Breakdown</h3>
<p>Here&#39;s a peek into the main components of our Node-RED flow:</p>
<p>1.) Listening to Discord Messages:</p>
<p>• (apivisBot): This node picks up every message in the Discord server. It’s our bot&#39;s ears in the support channel.
<img src="/img/discordbotwidget.webp" alt="/discordbotwidget">
<img src="/img/discordwidget.webp" alt="discorwidget open">
2.) Filtering Relevant Messages:</p>
<p>• switch (name of the discord channel): This node verifies that messages are from the &#39;support&#39; channel.</p>
<p>• switch (Filter Messages for Bot Response): This smart filter ensures only messages directed at the bot (e.g., containing &quot;Hey Bot&quot;) are processed further. In this flow all messages are passed on with the otherwise filter. Remove that one so that the bot is not answer all conversations.</p>
<p>3.) Processing Messages:</p>
<p>• template (json for role and content): Prepares the message content for our AI assistant by creating a JSON structure.</p>
<p>• change nodes: Assist in setting necessary fields and managing session IDs.</p>
<p>• OpenAI API Integration Nodes:</p>
<p>listAssistants: Fetches available assistants from OpenAI.</p>
<p>createThreadAndRun: Initiates a conversation thread with OpenAI.</p>
<p>createMessage: Sends the user’s message to OpenAI.</p>
<p>retrieveRun: Checks the status of the conversation.</p>
<p>4.) Handling Conversations:</p>
<p>• switch (session exist or not?) and switch (new session or continue?): These nodes manage whether the conversation is a new one or an ongoing session.</p>
<p>• function nodes: These craft the necessary payloads for each step and manage conversation threads.</p>
<p>5.) Responding to Users:</p>
<p>• discordMessageManager: Sends OpenAI’s responses back to the user in Discord.</p>
<p>•discordTyping: Simulates typing status to let users know the bot is processing their request.</p>
<h3>How It All Connects</h3>
<p>1.) Initialization:</p>
<p>• The flow starts when a message is detected in the Discord &#39;support&#39; channel.</p>
<p>• The switch nodes filter out irrelevant messages and ensure only commands for the bot are processed.</p>
<p>2.) Session Management:</p>
<p>• If it’s a brand-new conversation, the bot kicks off a new session with OpenAI using the createThreadAndRun node.</p>
<p>• For ongoing conversations, the bot retrieves the existing thread and adds to it. This is managed by the switch (session exist or not?) node.</p>
<p>3.) Creating and Sending Messages:</p>
<p>• The template node structures the user’s input, and createMessage sends it to OpenAI.</p>
<p>• The status of this message is tracked using retrieveRun, and based on the status (queued, in progress, completed), appropriate actions are taken.</p>
<p>4.) Generating Responses:</p>
<p>• OpenAI processes the input, and the bot fetches the response with listMessages.</p>
<p>• To handle Discord&#39;s message limits, messages longer than 2000 characters are split and sent in chunks by the splitLongMessages function.</p>
<p>5.) User Feedback:</p>
<p>• Finally, discordMessageManager ensures the bot’s response reaches the user, and discordTyping simulates real-time typing, enhancing the user experience.</p>
<h3>How to setup Discord</h3>
<p>To start using Discord I found the following site very helpful: <a href="https://www.writebots.com">https://www.writebots.com</a></p>
<h3>The flow</h3>
<pre><code class="language-json">[{&quot;id&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;type&quot;:&quot;tab&quot;,&quot;label&quot;:&quot;My Discord Bot&quot;,&quot;disabled&quot;:false,&quot;info&quot;:&quot;&quot;,&quot;env&quot;:[]},{&quot;id&quot;:&quot;e35bc33174b516e1&quot;,&quot;type&quot;:&quot;switch&quot;,&quot;z&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;name&quot;:&quot;Run Status Loop\\n queued\\n in progress\\n completed\\n exception&quot;,&quot;property&quot;:&quot;payload.status&quot;,&quot;propertyType&quot;:&quot;msg&quot;,&quot;rules&quot;:[{&quot;t&quot;:&quot;eq&quot;,&quot;v&quot;:&quot;queued&quot;,&quot;vt&quot;:&quot;str&quot;},{&quot;t&quot;:&quot;eq&quot;,&quot;v&quot;:&quot;in_progress&quot;,&quot;vt&quot;:&quot;str&quot;},{&quot;t&quot;:&quot;eq&quot;,&quot;v&quot;:&quot;completed&quot;,&quot;vt&quot;:&quot;str&quot;},{&quot;t&quot;:&quot;else&quot;}],&quot;checkall&quot;:&quot;true&quot;,&quot;repair&quot;:false,&quot;outputs&quot;:4,&quot;x&quot;:1050,&quot;y&quot;:820,&quot;wires&quot;:[[&quot;03824a6fa797e561&quot;],[&quot;03824a6fa797e561&quot;],[&quot;ae0a1f2eb1dda4e2&quot;],[]],&quot;inputLabels&quot;:[&quot;Run Details&quot;],&quot;outputLabels&quot;:[&quot;Run Queued&quot;,&quot;Run In Progress&quot;,&quot;Run Complete&quot;,&quot;Run Exception&quot;]},{&quot;id&quot;:&quot;f490e04616a4c1e3&quot;,&quot;type&quot;:&quot;change&quot;,&quot;z&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;name&quot;:&quot;Create Run Payload&quot;,&quot;rules&quot;:[{&quot;t&quot;:&quot;set&quot;,&quot;p&quot;:&quot;payload&quot;,&quot;pt&quot;:&quot;msg&quot;,&quot;to&quot;:&quot;{}&quot;,&quot;tot&quot;:&quot;json&quot;},{&quot;t&quot;:&quot;set&quot;,&quot;p&quot;:&quot;payload.thread_id&quot;,&quot;pt&quot;:&quot;msg&quot;,&quot;to&quot;:&quot;payload.thread_id&quot;,&quot;tot&quot;:&quot;flow&quot;},{&quot;t&quot;:&quot;set&quot;,&quot;p&quot;:&quot;payload.assistant_id&quot;,&quot;pt&quot;:&quot;msg&quot;,&quot;to&quot;:&quot;payload.assistant_id&quot;,&quot;tot&quot;:&quot;flow&quot;}],&quot;action&quot;:&quot;&quot;,&quot;property&quot;:&quot;&quot;,&quot;from&quot;:&quot;&quot;,&quot;to&quot;:&quot;&quot;,&quot;reg&quot;:false,&quot;x&quot;:680,&quot;y&quot;:780,&quot;wires&quot;:[[&quot;88281ee04095186d&quot;]]},{&quot;id&quot;:&quot;76bd5072b349fbc4&quot;,&quot;type&quot;:&quot;function&quot;,&quot;z&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;name&quot;:&quot;Create Run Payload&quot;,&quot;func&quot;:&quot;let assistants = msg.payload;\nlet assistant = assistants.find(assistant =&gt; assistant.name === msg.assistant.name);\nmsg.payload = {};\nif (assistant) {\n  // Retrieved the assistant, now create the payload for the next node\n  msg.payload.assistant_id = assistant.id;\n  msg.payload.thread = msg.assistant.thread;\n} else {\n  // No assistant found with the given name\n  msg.payload = null;\n}\nreturn msg;\n&quot;,&quot;outputs&quot;:1,&quot;timeout&quot;:&quot;&quot;,&quot;noerr&quot;:0,&quot;initialize&quot;:&quot;&quot;,&quot;finalize&quot;:&quot;&quot;,&quot;libs&quot;:[],&quot;x&quot;:420,&quot;y&quot;:520,&quot;wires&quot;:[[&quot;f346367be7ea755c&quot;]]},{&quot;id&quot;:&quot;03824a6fa797e561&quot;,&quot;type&quot;:&quot;function&quot;,&quot;z&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;name&quot;:&quot;Create Run Status Payload&quot;,&quot;func&quot;:&quot;let thread_id = msg.payload.thread_id;\n\nlet run_id = msg.payload.id;\n\nmsg.payload = {\n  thread_id: thread_id,\n  run_id: run_id\n};\n\nreturn msg;&quot;,&quot;outputs&quot;:1,&quot;noerr&quot;:0,&quot;initialize&quot;:&quot;&quot;,&quot;finalize&quot;:&quot;&quot;,&quot;libs&quot;:[],&quot;x&quot;:520,&quot;y&quot;:620,&quot;wires&quot;:[[&quot;faaa655ee247cd64&quot;]]},{&quot;id&quot;:&quot;515d4baa1a9ff994&quot;,&quot;type&quot;:&quot;function&quot;,&quot;z&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;name&quot;:&quot;Extract Thread Id&quot;,&quot;func&quot;:&quot;msg.payload = {\n  thread_id: msg.payload.thread_id\n}\n\nreturn msg;&quot;,&quot;outputs&quot;:1,&quot;noerr&quot;:0,&quot;initialize&quot;:&quot;&quot;,&quot;finalize&quot;:&quot;&quot;,&quot;libs&quot;:[],&quot;x&quot;:230,&quot;y&quot;:980,&quot;wires&quot;:[[&quot;b390ac5f29990eeb&quot;]]},{&quot;id&quot;:&quot;f351af28511642c5&quot;,&quot;type&quot;:&quot;function&quot;,&quot;z&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;name&quot;:&quot;Store Conversation Details&quot;,&quot;func&quot;:&quot;flow.set(\&quot;payload.thread_id\&quot;, msg.payload[0].thread_id);\n\nflow.set(\&quot;payload.assistant_id\&quot;, msg.payload[0].assistant_id);\n\nreturn msg;&quot;,&quot;outputs&quot;:1,&quot;timeout&quot;:&quot;&quot;,&quot;noerr&quot;:0,&quot;initialize&quot;:&quot;&quot;,&quot;finalize&quot;:&quot;&quot;,&quot;libs&quot;:[],&quot;x&quot;:660,&quot;y&quot;:1040,&quot;wires&quot;:[[]]},{&quot;id&quot;:&quot;3e19767be4912027&quot;,&quot;type&quot;:&quot;change&quot;,&quot;z&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;name&quot;:&quot;&quot;,&quot;rules&quot;:[{&quot;t&quot;:&quot;set&quot;,&quot;p&quot;:&quot;assistant.name&quot;,&quot;pt&quot;:&quot;msg&quot;,&quot;to&quot;:&quot;_node-red-assistant_&quot;,&quot;tot&quot;:&quot;str&quot;}],&quot;action&quot;:&quot;&quot;,&quot;property&quot;:&quot;&quot;,&quot;from&quot;:&quot;&quot;,&quot;to&quot;:&quot;&quot;,&quot;reg&quot;:false,&quot;x&quot;:750,&quot;y&quot;:80,&quot;wires&quot;:[[&quot;fb67c5a72cc3d992&quot;]]},{&quot;id&quot;:&quot;b6bed72d23b6907b&quot;,&quot;type&quot;:&quot;template&quot;,&quot;z&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;name&quot;:&quot;json for role and content&quot;,&quot;field&quot;:&quot;assistant.thread&quot;,&quot;fieldType&quot;:&quot;msg&quot;,&quot;format&quot;:&quot;handlebars&quot;,&quot;syntax&quot;:&quot;mustache&quot;,&quot;template&quot;:&quot;{\n  \&quot;messages\&quot;: [\n    {\n      \&quot;role\&quot;: \&quot;user\&quot;,\n      \&quot;content\&quot;: \&quot;{{data.cleanContent}}\&quot;\n    }\n  ]\n}&quot;,&quot;output&quot;:&quot;json&quot;,&quot;x&quot;:250,&quot;y&quot;:400,&quot;wires&quot;:[[&quot;97b13084c09ae872&quot;]]},{&quot;id&quot;:&quot;3a91799be127a7f6&quot;,&quot;type&quot;:&quot;OpenAI API&quot;,&quot;z&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;name&quot;:&quot;Create Thread &amp; Run&quot;,&quot;property&quot;:&quot;payload&quot;,&quot;propertyType&quot;:&quot;msg&quot;,&quot;service&quot;:&quot;155bf6b44322f868&quot;,&quot;method&quot;:&quot;createThreadAndRun&quot;,&quot;x&quot;:240,&quot;y&quot;:620,&quot;wires&quot;:[[&quot;03824a6fa797e561&quot;]]},{&quot;id&quot;:&quot;faaa655ee247cd64&quot;,&quot;type&quot;:&quot;OpenAI API&quot;,&quot;z&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;name&quot;:&quot;Retrieve Run&quot;,&quot;property&quot;:&quot;payload&quot;,&quot;propertyType&quot;:&quot;msg&quot;,&quot;service&quot;:&quot;155bf6b44322f868&quot;,&quot;method&quot;:&quot;getRun&quot;,&quot;x&quot;:730,&quot;y&quot;:620,&quot;wires&quot;:[[&quot;e35bc33174b516e1&quot;]]},{&quot;id&quot;:&quot;b390ac5f29990eeb&quot;,&quot;type&quot;:&quot;OpenAI API&quot;,&quot;z&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;name&quot;:&quot;List Messages&quot;,&quot;property&quot;:&quot;payload&quot;,&quot;propertyType&quot;:&quot;msg&quot;,&quot;service&quot;:&quot;155bf6b44322f868&quot;,&quot;method&quot;:&quot;listMessages&quot;,&quot;x&quot;:420,&quot;y&quot;:980,&quot;wires&quot;:[[&quot;d1d86114340006d7&quot;,&quot;f351af28511642c5&quot;]]},{&quot;id&quot;:&quot;0bdbf8ab7abc31c2&quot;,&quot;type&quot;:&quot;OpenAI API&quot;,&quot;z&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;name&quot;:&quot;Create Message&quot;,&quot;property&quot;:&quot;payload&quot;,&quot;propertyType&quot;:&quot;msg&quot;,&quot;service&quot;:&quot;155bf6b44322f868&quot;,&quot;method&quot;:&quot;createMessage&quot;,&quot;x&quot;:480,&quot;y&quot;:780,&quot;wires&quot;:[[&quot;f490e04616a4c1e3&quot;]]},{&quot;id&quot;:&quot;88281ee04095186d&quot;,&quot;type&quot;:&quot;OpenAI API&quot;,&quot;z&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;name&quot;:&quot;Create Run&quot;,&quot;property&quot;:&quot;payload&quot;,&quot;propertyType&quot;:&quot;msg&quot;,&quot;service&quot;:&quot;155bf6b44322f868&quot;,&quot;method&quot;:&quot;createRun&quot;,&quot;x&quot;:870,&quot;y&quot;:780,&quot;wires&quot;:[[&quot;e35bc33174b516e1&quot;]]},{&quot;id&quot;:&quot;35a08e5a7e88ca67&quot;,&quot;type&quot;:&quot;OpenAI API&quot;,&quot;z&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;name&quot;:&quot;List Assistants&quot;,&quot;property&quot;:&quot;payload&quot;,&quot;propertyType&quot;:&quot;msg&quot;,&quot;service&quot;:&quot;155bf6b44322f868&quot;,&quot;method&quot;:&quot;listAssistants&quot;,&quot;x&quot;:220,&quot;y&quot;:520,&quot;wires&quot;:[[&quot;76bd5072b349fbc4&quot;]],&quot;outputLabels&quot;:[&quot;Assistant Objects&quot;]},{&quot;id&quot;:&quot;b02093886b6b7f48&quot;,&quot;type&quot;:&quot;switch&quot;,&quot;z&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;name&quot;:&quot;new session or continue?&quot;,&quot;property&quot;:&quot;_session.id&quot;,&quot;propertyType&quot;:&quot;msg&quot;,&quot;rules&quot;:[{&quot;t&quot;:&quot;eq&quot;,&quot;v&quot;:&quot;_session.id&quot;,&quot;vt&quot;:&quot;flow&quot;},{&quot;t&quot;:&quot;else&quot;}],&quot;checkall&quot;:&quot;true&quot;,&quot;repair&quot;:false,&quot;outputs&quot;:2,&quot;x&quot;:710,&quot;y&quot;:380,&quot;wires&quot;:[[&quot;37395105b817f19b&quot;],[&quot;ea7790779cdffc5f&quot;]]},{&quot;id&quot;:&quot;f346367be7ea755c&quot;,&quot;type&quot;:&quot;change&quot;,&quot;z&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;name&quot;:&quot;set flow._session.id&quot;,&quot;rules&quot;:[{&quot;t&quot;:&quot;set&quot;,&quot;p&quot;:&quot;_session.id&quot;,&quot;pt&quot;:&quot;flow&quot;,&quot;to&quot;:&quot;_session.id&quot;,&quot;tot&quot;:&quot;msg&quot;}],&quot;action&quot;:&quot;&quot;,&quot;property&quot;:&quot;&quot;,&quot;from&quot;:&quot;&quot;,&quot;to&quot;:&quot;&quot;,&quot;reg&quot;:false,&quot;x&quot;:630,&quot;y&quot;:520,&quot;wires&quot;:[[&quot;ba7ef04e22ee604f&quot;]]},{&quot;id&quot;:&quot;152a9e9b11ef9d5e&quot;,&quot;type&quot;:&quot;change&quot;,&quot;z&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;name&quot;:&quot;set msg.payload.thread_id&quot;,&quot;rules&quot;:[{&quot;t&quot;:&quot;set&quot;,&quot;p&quot;:&quot;payload.thread_id&quot;,&quot;pt&quot;:&quot;msg&quot;,&quot;to&quot;:&quot;payload.thread_id&quot;,&quot;tot&quot;:&quot;flow&quot;},{&quot;t&quot;:&quot;set&quot;,&quot;p&quot;:&quot;payload.role&quot;,&quot;pt&quot;:&quot;msg&quot;,&quot;to&quot;:&quot;user&quot;,&quot;tot&quot;:&quot;str&quot;},{&quot;t&quot;:&quot;set&quot;,&quot;p&quot;:&quot;payload.content&quot;,&quot;pt&quot;:&quot;msg&quot;,&quot;to&quot;:&quot;payload.textField&quot;,&quot;tot&quot;:&quot;msg&quot;},{&quot;t&quot;:&quot;delete&quot;,&quot;p&quot;:&quot;payload.textField&quot;,&quot;pt&quot;:&quot;msg&quot;},{&quot;t&quot;:&quot;delete&quot;,&quot;p&quot;:&quot;payload.host&quot;,&quot;pt&quot;:&quot;msg&quot;},{&quot;t&quot;:&quot;delete&quot;,&quot;p&quot;:&quot;payload.kb&quot;,&quot;pt&quot;:&quot;msg&quot;},{&quot;t&quot;:&quot;delete&quot;,&quot;p&quot;:&quot;payload.imageClassification&quot;,&quot;pt&quot;:&quot;msg&quot;}],&quot;action&quot;:&quot;&quot;,&quot;property&quot;:&quot;&quot;,&quot;from&quot;:&quot;&quot;,&quot;to&quot;:&quot;&quot;,&quot;reg&quot;:false,&quot;x&quot;:260,&quot;y&quot;:780,&quot;wires&quot;:[[&quot;0bdbf8ab7abc31c2&quot;]]},{&quot;id&quot;:&quot;81fcfd91c1a5a878&quot;,&quot;type&quot;:&quot;discordMessage&quot;,&quot;z&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;name&quot;:&quot;apivisBot&quot;,&quot;channelIdFilter&quot;:&quot;&quot;,&quot;token&quot;:&quot;&quot;,&quot;x&quot;:160,&quot;y&quot;:100,&quot;wires&quot;:[[&quot;9e623708288e743e&quot;]]},{&quot;id&quot;:&quot;0e316ec9e15ae219&quot;,&quot;type&quot;:&quot;switch&quot;,&quot;z&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;name&quot;:&quot;Filter Messages for Bot Response&quot;,&quot;property&quot;:&quot;data.content&quot;,&quot;propertyType&quot;:&quot;msg&quot;,&quot;rules&quot;:[{&quot;t&quot;:&quot;cont&quot;,&quot;v&quot;:&quot;Hey Bot&quot;,&quot;vt&quot;:&quot;str&quot;},{&quot;t&quot;:&quot;cont&quot;,&quot;v&quot;:&quot;hey bot&quot;,&quot;vt&quot;:&quot;str&quot;},{&quot;t&quot;:&quot;regex&quot;,&quot;v&quot;:&quot;\\!Hey\\sBot&quot;,&quot;vt&quot;:&quot;str&quot;,&quot;case&quot;:true},{&quot;t&quot;:&quot;else&quot;}],&quot;checkall&quot;:&quot;false&quot;,&quot;repair&quot;:true,&quot;outputs&quot;:4,&quot;x&quot;:280,&quot;y&quot;:200,&quot;wires&quot;:[[&quot;3d2796e8ed3ecac4&quot;],[&quot;951e095ea6f2d1f4&quot;],[&quot;adc550621be4d43b&quot;],[&quot;a1ac66c1b29ba54e&quot;]]},{&quot;id&quot;:&quot;d1d86114340006d7&quot;,&quot;type&quot;:&quot;function&quot;,&quot;z&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;name&quot;:&quot;function 9&quot;,&quot;func&quot;:&quot;// Get the text content from the message payload\nconst text = msg.payload[0].content[0].text.value || &#39;&#39;;\n\n// Initialize an array to hold the new messages\nconst newMessages = [];\n\n// Check the length of the text\nif (text.length &gt; 2000) {\n  // Split the text into chunks of 2000 characters\n  const maxLength = 2000;\n  const chunks = [];\n  for (let i = 0; i &lt; text.length; i += maxLength) {\n    chunks.push(text.substring(i, i + maxLength));\n  }\n\n  // Create new messages for each chunk\n  chunks.forEach((chunk, index) =&gt; {\n    // Create a deep copy of the original message to maintain all other data\n    const newMsg = RED.util.cloneMessage(msg);\n\n    // Update the _msgid to be unique for each chunk\n    newMsg._msgid = `${msg._msgid}_${index}`;\n\n    // Update the text content with the chunk\n    newMsg.payload[0].content[0].text.value = chunk;\n\n    // Send the new message\n    node.send(newMsg);\n  });\n\n  // Return null to indicate that the original message has been processed\n  return null;\n}\n\n// If the text is not longer than 2000 characters, return the original message\nreturn msg;\n&quot;,&quot;outputs&quot;:1,&quot;timeout&quot;:0,&quot;noerr&quot;:0,&quot;initialize&quot;:&quot;&quot;,&quot;finalize&quot;:&quot;&quot;,&quot;libs&quot;:[],&quot;x&quot;:600,&quot;y&quot;:980,&quot;wires&quot;:[[&quot;1fe05e16e32b75eb&quot;]]},{&quot;id&quot;:&quot;84d4199b0ac63d8b&quot;,&quot;type&quot;:&quot;discordMessageManager&quot;,&quot;z&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;name&quot;:&quot;Response&quot;,&quot;channel&quot;:&quot;&quot;,&quot;token&quot;:&quot;&quot;,&quot;x&quot;:940,&quot;y&quot;:980,&quot;wires&quot;:[[&quot;7202e3272bb4d901&quot;]]},{&quot;id&quot;:&quot;7202e3272bb4d901&quot;,&quot;type&quot;:&quot;debug&quot;,&quot;z&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;name&quot;:&quot;debug 107&quot;,&quot;active&quot;:true,&quot;tosidebar&quot;:true,&quot;console&quot;:false,&quot;tostatus&quot;:false,&quot;complete&quot;:&quot;false&quot;,&quot;statusVal&quot;:&quot;&quot;,&quot;statusType&quot;:&quot;auto&quot;,&quot;x&quot;:1090,&quot;y&quot;:980,&quot;wires&quot;:[]},{&quot;id&quot;:&quot;020ad446c488be26&quot;,&quot;type&quot;:&quot;discordTyping&quot;,&quot;z&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;name&quot;:&quot;&quot;,&quot;channel&quot;:&quot;&quot;,&quot;token&quot;:&quot;&quot;,&quot;x&quot;:780,&quot;y&quot;:180,&quot;wires&quot;:[]},{&quot;id&quot;:&quot;97b13084c09ae872&quot;,&quot;type&quot;:&quot;switch&quot;,&quot;z&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;name&quot;:&quot;session exist or not?&quot;,&quot;property&quot;:&quot;_session.id&quot;,&quot;propertyType&quot;:&quot;msg&quot;,&quot;rules&quot;:[{&quot;t&quot;:&quot;nnull&quot;},{&quot;t&quot;:&quot;else&quot;}],&quot;checkall&quot;:&quot;true&quot;,&quot;repair&quot;:false,&quot;outputs&quot;:2,&quot;x&quot;:480,&quot;y&quot;:400,&quot;wires&quot;:[[&quot;b02093886b6b7f48&quot;],[&quot;e8956df02b5c50ff&quot;]]},{&quot;id&quot;:&quot;ed639d51e07cc132&quot;,&quot;type&quot;:&quot;template&quot;,&quot;z&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;name&quot;:&quot;&quot;,&quot;field&quot;:&quot;payload&quot;,&quot;fieldType&quot;:&quot;msg&quot;,&quot;format&quot;:&quot;handlebars&quot;,&quot;syntax&quot;:&quot;mustache&quot;,&quot;template&quot;:&quot;{\n  \&quot;content\&quot;: \&quot;{{payload}}\&quot;\n}&quot;,&quot;output&quot;:&quot;json&quot;,&quot;x&quot;:560,&quot;y&quot;:80,&quot;wires&quot;:[[&quot;3e19767be4912027&quot;]]},{&quot;id&quot;:&quot;1fe05e16e32b75eb&quot;,&quot;type&quot;:&quot;change&quot;,&quot;z&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;name&quot;:&quot;&quot;,&quot;rules&quot;:[{&quot;t&quot;:&quot;set&quot;,&quot;p&quot;:&quot;payload&quot;,&quot;pt&quot;:&quot;msg&quot;,&quot;to&quot;:&quot;payload[0].content[0].text.value&quot;,&quot;tot&quot;:&quot;msg&quot;},{&quot;t&quot;:&quot;set&quot;,&quot;p&quot;:&quot;request&quot;,&quot;pt&quot;:&quot;msg&quot;,&quot;to&quot;:&quot;payload[1].content[0].text.value&quot;,&quot;tot&quot;:&quot;msg&quot;}],&quot;action&quot;:&quot;&quot;,&quot;property&quot;:&quot;&quot;,&quot;from&quot;:&quot;&quot;,&quot;to&quot;:&quot;&quot;,&quot;reg&quot;:false,&quot;x&quot;:760,&quot;y&quot;:980,&quot;wires&quot;:[[&quot;84d4199b0ac63d8b&quot;]]},{&quot;id&quot;:&quot;37395105b817f19b&quot;,&quot;type&quot;:&quot;link out&quot;,&quot;z&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;name&quot;:&quot;continue&quot;,&quot;mode&quot;:&quot;link&quot;,&quot;links&quot;:[&quot;37e930a01616d311&quot;],&quot;x&quot;:865,&quot;y&quot;:360,&quot;wires&quot;:[]},{&quot;id&quot;:&quot;ea7790779cdffc5f&quot;,&quot;type&quot;:&quot;link out&quot;,&quot;z&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;name&quot;:&quot;link out 2&quot;,&quot;mode&quot;:&quot;link&quot;,&quot;links&quot;:[&quot;1e4b3f1d11b89198&quot;],&quot;x&quot;:865,&quot;y&quot;:400,&quot;wires&quot;:[]},{&quot;id&quot;:&quot;37e930a01616d311&quot;,&quot;type&quot;:&quot;link in&quot;,&quot;z&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;name&quot;:&quot;link in 1&quot;,&quot;links&quot;:[&quot;37395105b817f19b&quot;],&quot;x&quot;:115,&quot;y&quot;:780,&quot;wires&quot;:[[&quot;152a9e9b11ef9d5e&quot;]]},{&quot;id&quot;:&quot;1e4b3f1d11b89198&quot;,&quot;type&quot;:&quot;link in&quot;,&quot;z&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;name&quot;:&quot;link in 2&quot;,&quot;links&quot;:[&quot;ea7790779cdffc5f&quot;,&quot;e8956df02b5c50ff&quot;],&quot;x&quot;:115,&quot;y&quot;:520,&quot;wires&quot;:[[&quot;35a08e5a7e88ca67&quot;]]},{&quot;id&quot;:&quot;e8956df02b5c50ff&quot;,&quot;type&quot;:&quot;link out&quot;,&quot;z&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;name&quot;:&quot;link out 3&quot;,&quot;mode&quot;:&quot;link&quot;,&quot;links&quot;:[&quot;76d2bbf2a56c9d07&quot;,&quot;1e4b3f1d11b89198&quot;],&quot;x&quot;:615,&quot;y&quot;:420,&quot;wires&quot;:[]},{&quot;id&quot;:&quot;7397aae6ede41b4b&quot;,&quot;type&quot;:&quot;catch&quot;,&quot;z&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;name&quot;:&quot;&quot;,&quot;scope&quot;:null,&quot;uncaught&quot;:false,&quot;x&quot;:160,&quot;y&quot;:300,&quot;wires&quot;:[[&quot;6d9ffb0b28d49c58&quot;]]},{&quot;id&quot;:&quot;6d9ffb0b28d49c58&quot;,&quot;type&quot;:&quot;debug&quot;,&quot;z&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;name&quot;:&quot;CatchtestDiscordFlow&quot;,&quot;active&quot;:true,&quot;tosidebar&quot;:true,&quot;console&quot;:false,&quot;tostatus&quot;:false,&quot;complete&quot;:&quot;true&quot;,&quot;targetType&quot;:&quot;full&quot;,&quot;statusVal&quot;:&quot;&quot;,&quot;statusType&quot;:&quot;auto&quot;,&quot;x&quot;:340,&quot;y&quot;:300,&quot;wires&quot;:[]},{&quot;id&quot;:&quot;9e623708288e743e&quot;,&quot;type&quot;:&quot;switch&quot;,&quot;z&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;name&quot;:&quot;name of the discord channel&quot;,&quot;property&quot;:&quot;channel.name&quot;,&quot;propertyType&quot;:&quot;msg&quot;,&quot;rules&quot;:[{&quot;t&quot;:&quot;eq&quot;,&quot;v&quot;:&quot;support&quot;,&quot;vt&quot;:&quot;str&quot;},{&quot;t&quot;:&quot;else&quot;}],&quot;checkall&quot;:&quot;true&quot;,&quot;repair&quot;:false,&quot;outputs&quot;:2,&quot;x&quot;:360,&quot;y&quot;:100,&quot;wires&quot;:[[&quot;ed639d51e07cc132&quot;],[]]},{&quot;id&quot;:&quot;3d2796e8ed3ecac4&quot;,&quot;type&quot;:&quot;link out&quot;,&quot;z&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;name&quot;:&quot;link out 369&quot;,&quot;mode&quot;:&quot;link&quot;,&quot;links&quot;:[&quot;69dc4b4d1e01327d&quot;,&quot;fef2651f90accdc3&quot;],&quot;x&quot;:475,&quot;y&quot;:180,&quot;wires&quot;:[]},{&quot;id&quot;:&quot;951e095ea6f2d1f4&quot;,&quot;type&quot;:&quot;link out&quot;,&quot;z&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;name&quot;:&quot;link out 370&quot;,&quot;mode&quot;:&quot;link&quot;,&quot;links&quot;:[&quot;69dc4b4d1e01327d&quot;],&quot;x&quot;:515,&quot;y&quot;:200,&quot;wires&quot;:[]},{&quot;id&quot;:&quot;a1ac66c1b29ba54e&quot;,&quot;type&quot;:&quot;link out&quot;,&quot;z&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;name&quot;:&quot;link out 371&quot;,&quot;mode&quot;:&quot;link&quot;,&quot;links&quot;:[&quot;69dc4b4d1e01327d&quot;,&quot;fef2651f90accdc3&quot;],&quot;x&quot;:595,&quot;y&quot;:240,&quot;wires&quot;:[]},{&quot;id&quot;:&quot;69dc4b4d1e01327d&quot;,&quot;type&quot;:&quot;link in&quot;,&quot;z&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;name&quot;:&quot;link in 307&quot;,&quot;links&quot;:[&quot;3d2796e8ed3ecac4&quot;,&quot;951e095ea6f2d1f4&quot;,&quot;a1ac66c1b29ba54e&quot;],&quot;x&quot;:115,&quot;y&quot;:400,&quot;wires&quot;:[[&quot;b6bed72d23b6907b&quot;]]},{&quot;id&quot;:&quot;fef2651f90accdc3&quot;,&quot;type&quot;:&quot;link in&quot;,&quot;z&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;name&quot;:&quot;link in 308&quot;,&quot;links&quot;:[&quot;3d2796e8ed3ecac4&quot;,&quot;a1ac66c1b29ba54e&quot;,&quot;adc550621be4d43b&quot;],&quot;x&quot;:675,&quot;y&quot;:180,&quot;wires&quot;:[[&quot;020ad446c488be26&quot;]]},{&quot;id&quot;:&quot;adc550621be4d43b&quot;,&quot;type&quot;:&quot;link out&quot;,&quot;z&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;name&quot;:&quot;link out 372&quot;,&quot;mode&quot;:&quot;link&quot;,&quot;links&quot;:[&quot;fef2651f90accdc3&quot;],&quot;x&quot;:555,&quot;y&quot;:220,&quot;wires&quot;:[]},{&quot;id&quot;:&quot;ba7ef04e22ee604f&quot;,&quot;type&quot;:&quot;link out&quot;,&quot;z&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;name&quot;:&quot;link out 373&quot;,&quot;mode&quot;:&quot;link&quot;,&quot;links&quot;:[&quot;604ebf162e54cefb&quot;],&quot;x&quot;:755,&quot;y&quot;:520,&quot;wires&quot;:[]},{&quot;id&quot;:&quot;604ebf162e54cefb&quot;,&quot;type&quot;:&quot;link in&quot;,&quot;z&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;name&quot;:&quot;link in 309&quot;,&quot;links&quot;:[&quot;ba7ef04e22ee604f&quot;],&quot;x&quot;:115,&quot;y&quot;:620,&quot;wires&quot;:[[&quot;3a91799be127a7f6&quot;]]},{&quot;id&quot;:&quot;ae0a1f2eb1dda4e2&quot;,&quot;type&quot;:&quot;link out&quot;,&quot;z&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;name&quot;:&quot;link out 374&quot;,&quot;mode&quot;:&quot;link&quot;,&quot;links&quot;:[&quot;14c58d79b5dea4b9&quot;],&quot;x&quot;:1195,&quot;y&quot;:840,&quot;wires&quot;:[]},{&quot;id&quot;:&quot;14c58d79b5dea4b9&quot;,&quot;type&quot;:&quot;link in&quot;,&quot;z&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;name&quot;:&quot;link in 310&quot;,&quot;links&quot;:[&quot;ae0a1f2eb1dda4e2&quot;],&quot;x&quot;:115,&quot;y&quot;:980,&quot;wires&quot;:[[&quot;515d4baa1a9ff994&quot;]]},{&quot;id&quot;:&quot;ba41b71f8868f9f1&quot;,&quot;type&quot;:&quot;comment&quot;,&quot;z&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;name&quot;:&quot;new session&quot;,&quot;info&quot;:&quot;&quot;,&quot;x&quot;:170,&quot;y&quot;:460,&quot;wires&quot;:[]},{&quot;id&quot;:&quot;03e9d971972f6ae9&quot;,&quot;type&quot;:&quot;comment&quot;,&quot;z&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;name&quot;:&quot;continue session&quot;,&quot;info&quot;:&quot;&quot;,&quot;x&quot;:180,&quot;y&quot;:700,&quot;wires&quot;:[]},{&quot;id&quot;:&quot;85854c5d6cd9e960&quot;,&quot;type&quot;:&quot;link in&quot;,&quot;z&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;name&quot;:&quot;link in 311&quot;,&quot;links&quot;:[&quot;fb67c5a72cc3d992&quot;],&quot;x&quot;:115,&quot;y&quot;:200,&quot;wires&quot;:[[&quot;0e316ec9e15ae219&quot;]]},{&quot;id&quot;:&quot;fb67c5a72cc3d992&quot;,&quot;type&quot;:&quot;link out&quot;,&quot;z&quot;:&quot;95c94e0b20b62cc5&quot;,&quot;name&quot;:&quot;link out 375&quot;,&quot;mode&quot;:&quot;link&quot;,&quot;links&quot;:[&quot;85854c5d6cd9e960&quot;],&quot;x&quot;:885,&quot;y&quot;:80,&quot;wires&quot;:[]},{&quot;id&quot;:&quot;155bf6b44322f868&quot;,&quot;type&quot;:&quot;Service Host&quot;,&quot;apiBase&quot;:&quot;https://api.openai.com/v1&quot;,&quot;secureApiKeyHeaderOrQueryName&quot;:&quot;Authorization&quot;,&quot;organizationId&quot;:&quot;org-ldadft66yHlGaxjfue648&quot;,&quot;name&quot;:&quot;mykey&quot;}]
</code></pre>
</div>
        </section>
    </main>
    <footer>
        <p>&copy; 2025 APIVIS. All rights reserved.</p>
    </footer>
    <script src="../script.js"></script>
</body>
</html>